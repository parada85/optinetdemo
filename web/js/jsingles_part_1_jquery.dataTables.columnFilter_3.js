(function(A){A.fn.columnFilter=function(D){var B,T,J,H;var V="From {from} to {to}";var C=new Array();var G=new Array();var U=null;var S=function(){};function W(X,a,e,h,f){if(typeof a=="undefined"){return new Array()}if(typeof e=="undefined"){e=true}if(typeof h=="undefined"){h=true}if(typeof f=="undefined"){f=true}var m;if(h==true){m=X.aiDisplay}else{m=X.aiDisplayMaster}var l=new Array();for(var Z=0,d=m.length;Z<d;Z++){var b=m[Z];var Y=Q.fnGetData(b);var g=Y[a];if(f==true&&g.length==0){continue}else{if(e==true&&jQuery.inArray(g,l)>-1){continue}else{l.push(g)}}}return l.sort()}function R(X){if(I.bUseColVis){return X}else{return Q.fnSettings().oApi._fnVisibleToColumnIndex(Q.fnSettings(),X)}}function L(g,f,h,Y,c,i){var Z="text_filter";if(Y){Z="number_filter"}J=J.replace(/(^\s*)|(\s*$)/g,"");var a=g.fnSettings().aoPreSearchCols[T].sSearch;var X="search_init ";var b=J;if(a!=""&&a!="^"){if(Y&&a.charAt(0)=="^"){b=a.substr(1)}else{b=a}X=""}var e=A('<input type="text" class="'+X+Z+'" value="'+b+'"/>');if(i!=undefined&&i!=-1){e.attr("maxlength",i)}H.html(e);if(Y){H.wrapInner('<span class="filter_column filter_number" />')}else{H.wrapInner('<span class="filter_column filter_text" />')}B[T]=J;var d=T;if(Y&&!g.fnSettings().oFeatures.bServerSide){e.keyup(function(){g.fnFilter("^"+this.value,R(d),true,false);S()})}else{e.keyup(function(){if(g.fnSettings().oFeatures.bServerSide&&c!=0){var l=g.fnSettings().aoPreSearchCols[d].sSearch;var m=A(this).data("dt-iLastFilterLength");if(typeof m=="undefined"){m=0}var n=this.value.length;if(Math.abs(n-m)<c){return}else{A(this).data("dt-iLastFilterLength",n)}}g.fnFilter(this.value,R(d),f,h);S()})}e.focus(function(){if(A(this).hasClass("search_init")){A(this).removeClass("search_init");this.value=""}});e.blur(function(){if(this.value==""){A(this).addClass("search_init");this.value=B[d]}})}function F(X){H.html(M(0));var a=X.attr("id")+"_range_from_"+T;var c=A('<input type="text" class="number_range_filter" id="'+a+'" rel="'+T+'"/>');H.append(c);H.append(M(1));var Z=X.attr("id")+"_range_to_"+T;var b=A('<input type="text" class="number_range_filter" id="'+Z+'" rel="'+T+'"/>');H.append(b);H.append(M(2));H.wrapInner('<span class="filter_column filter_number_range" />');var Y=T;G.push(T);X.dataTableExt.afnFiltering.push(function(h,f,e){if(X.attr("id")!=h.sTableId){return true}if(document.getElementById(a)==null){return true}var g=document.getElementById(a).value*1;var d=document.getElementById(Z).value*1;var i=f[R(Y)]=="-"?0:f[R(Y)]*1;if(g==""&&d==""){return true}else{if(g==""&&i<=d){return true}else{if(g<=i&&""==d){return true}else{if(g<=i&&i<=d){return true}}}}return false});A("#"+a+",#"+Z,H).keyup(function(){var e=document.getElementById(a).value*1;var d=document.getElementById(Z).value*1;if(e!=0&&d!=0&&e>d){return}X.fnDraw();S()})}function N(X){var Z=V.split(/[}{]/);H.html("");var b=X.attr("id")+"_range_from_"+T;var d=A('<input type="text" class="date_range_filter" id="'+b+'" rel="'+T+'"/>');d.datepicker();var a=X.attr("id")+"_range_to_"+T;var c=A('<input type="text" class="date_range_filter" id="'+a+'" rel="'+T+'"/>');for(ti=0;ti<Z.length;ti++){if(Z[ti]==I.sDateFromToken){H.append(d)}else{if(Z[ti]==I.sDateToToken){H.append(c)}else{H.append(Z[ti])}}}H.wrapInner('<span class="filter_column filter_date_range" />');c.datepicker();var Y=T;G.push(T);X.dataTableExt.afnFiltering.push(function(m,h,g){if(X.attr("id")!=m.sTableId){return true}var f=d.datepicker("getDate");var e=c.datepicker("getDate");if(f==null&&e==null){return true}var l=null;try{if(h[R(Y)]==null||h[R(Y)]==""){return false}l=A.datepicker.parseDate(A.datepicker.regional[""].dateFormat,h[R(Y)])}catch(i){return false}if(l==null){return false}if(f==null&&l<=e){return true}else{if(f<=l&&e==null){return true}else{if(f<=l&&l<=e){return true}}}return false});A("#"+b+",#"+a,H).change(function(){X.fnDraw();S()})}function O(l,b,f,Y,m,h,a){if(b==null){b=W(l.fnSettings(),f,true,false,true)}var g=f;var e=l.fnSettings().aoPreSearchCols[T].sSearch;if(e==null||e==""){e=a}var X='<select class="search_init select_filter"><option value="" class="search_init">'+m+"</option>";var d=0;var Z=b.length;for(d=0;d<Z;d++){if(typeof(b[d])!="object"){var c="";if(escape(b[d])==e||escape(b[d])==escape(e)){c="selected "}X+="<option "+c+' value="'+escape(b[d])+'">'+b[d]+"</option>"}else{var c="";if(h){if(b[d].value==e){c="selected "}X+="<option "+c+'value="'+b[d].value+'">'+b[d].label+"</option>"}else{if(escape(b[d].value)==e){c="selected "}X+="<option "+c+'value="'+escape(b[d].value)+'">'+b[d].label+"</option>"}}}var i=A(X+"</select>");Y.html(i);Y.wrapInner('<span class="filter_column filter_select" />');i.change(function(){if(A(this).val()!=""){A(this).removeClass("search_init")}else{A(this).addClass("search_init")}if(h){l.fnFilter(A(this).val(),f,h)}else{l.fnFilter(unescape(A(this).val()),f)}S()});if(e!=null&&e!=""){l.fnFilter(unescape(e),f)}}function E(X,Y,Z,b){var a=X.fnSettings();if(Y==null&&a.sAjaxSource!=""&&!a.oFeatures.bServerSide){a.aoDrawCallback.push({fn:(function(c,e,d){return function(){if(a.iDraw==2&&a.sAjaxSource!=null&&a.sAjaxSource!=""&&!a.oFeatures.bServerSide){return O(X,null,R(c),e,d,Z,b)}}})(T,H,J),sName:"column_filter_"+T})}O(X,Y,R(T),H,J,Z,b)}function P(n,X){if(X==null){X=W(n.fnSettings(),T,true,true,true)}var c=T;var i="",p,o=X.length;var Z=J.replace("%","Perc").replace("&","AND").replace("$","DOL").replace("Â£","STERL").replace("@","AT").replace(/\s/g,"_");Z=Z.replace(/[^a-zA-Z 0-9]+/g,"");var l=J;if(I.sFilterButtonText!=null||I.sFilterButtonText!=undefined){l=I.sFilterButtonText}var q=10;var g=12;var f=Math.floor(o/g);if(o%g>0){f=f+1}var Y=100/f-2;var d=q*f;if(f==1){Y=20}var s='<div style="float:left; min-width: '+Y+'%; " >';var t="</div>";var e=n.attr("id")+Z;var b="chkBtnOpen"+e;var a=e+"-flt-toggle";i+='<button id="'+b+'" class="checkbox_filter" > '+l+"</button>";i+='<div id="'+a+'" title="'+J+'" class="toggle-check ui-widget-content ui-corner-all"  style="width: '+(d)+'%; " >';i+=s;for(p=0;p<o;p++){if(p%g==0&&p!=0){i+=t+s}i+='<input class="search_init checkbox_filter" type="checkbox" id= "'+X[p]+'" name= "'+Z+'" value="'+X[p]+'" >'+X[p]+"<br/>";var h=A(i);H.html(h);H.wrapInner('<span class="filter_column filter_checkbox" />');h.change(function(){var u="";var w="|";var r=A('input:checkbox[name="'+Z+'"]:checked').size();A('input:checkbox[name="'+Z+'"]:checked').each(function(x){if((x==0&&r==1)||(x!=0&&x==r-1)){w=""}u=u.replace(/^\s+|\s+$/g,"");u=u+A(this).val()+w;w="|"});for(var v=0;v<o;v++){if(u!=""){A("#"+X[v]).removeClass("search_init")}else{A("#"+X[v]).addClass("search_init")}}n.fnFilter(u,c,true,false);S()})}A("#"+b).button();A("#"+a).dialog({autoOpen:false,hide:"blind",buttons:[{text:"Reset",click:function(){A('input:checkbox[name="'+Z+'"]:checked').each(function(r){A(this).attr("checked",false);A(this).addClass("search_init")});n.fnFilter("",c,true,false);S();return false}},{text:"Close",click:function(){A(this).dialog("close")}}]});A("#"+b).click(function(){A("#"+a).dialog("open");var r=A(this);A("#"+a).dialog("widget").position({my:"top",at:"bottom",of:r});return false});var m=S;S=function(){var r=A("#"+b);A("#"+a).dialog("widget").position({my:"top",at:"bottom",of:r});m()}}function M(X){switch(X){case 0:return V.substring(0,V.indexOf("{from}"));case 1:return V.substring(V.indexOf("{from}")+6,V.indexOf("{to}"));default:return V.substring(V.indexOf("{to}")+4)}}var Q=this;var K={sPlaceHolder:"foot",sRangeSeparator:"~",iFilteringDelay:500,aoColumns:null,sRangeFormat:"From {from} to {to}",sDateFromToken:"from",sDateToToken:"to"};var I=A.extend(K,D);return this.each(function(){if(!Q.fnSettings().oFeatures.bFilter){return}B=new Array();var b=Q.fnSettings().aoFooter[0];var c=Q.fnSettings().nTFoot;var Z="tr";if(I.sPlaceHolder=="head:after"){var a=A("tr:first",Q.fnSettings().nTHead).detach();if(Q.fnSettings().bSortCellsTop){a.prependTo(A(Q.fnSettings().nTHead));b=Q.fnSettings().aoHeader[1]}else{a.appendTo(A(Q.fnSettings().nTHead));b=Q.fnSettings().aoHeader[0]}Z="tr:last";c=Q.fnSettings().nTHead}else{if(I.sPlaceHolder=="head:before"){if(Q.fnSettings().bSortCellsTop){var a=A("tr:first",Q.fnSettings().nTHead).detach();a.appendTo(A(Q.fnSettings().nTHead));b=Q.fnSettings().aoHeader[1]}else{b=Q.fnSettings().aoHeader[0]}Z="tr:first";c=Q.fnSettings().nTHead}}A(b).each(function(d){T=d;var e={type:"text",bRegex:false,bSmart:true,iMaxLenght:-1,iFilterLength:0};if(I.aoColumns!=null){if(I.aoColumns.length<T||I.aoColumns[T]==null){return}e=I.aoColumns[T]}J=A(A(this)[0].cell).text();if(e.sSelector==null){H=A(A(this)[0].cell)}else{H=A(e.sSelector);if(H.length==0){H=A(A(this)[0].cell)}}if(e!=null){if(e.sRangeFormat!=null){V=e.sRangeFormat}else{V=I.sRangeFormat}switch(e.type){case"null":break;case"number":L(Q,true,false,true,e.iFilterLength,e.iMaxLenght);break;case"select":if(e.bRegex!=true){e.bRegex=false}E(Q,e.values,e.bRegex,e.selected);break;case"number-range":F(Q);break;case"date-range":N(Q);break;case"checkbox":P(Q,e.values);break;case"text":default:bRegex=(e.bRegex==null?false:e.bRegex);bSmart=(e.bSmart==null?false:e.bSmart);L(Q,bRegex,bSmart,false,e.iFilterLength,e.iMaxLenght);break}}});for(j=0;j<G.length;j++){var Y=function(){var d=Q.attr("id");return A("#"+d+"_range_from_"+G[j]).val()+I.sRangeSeparator+A("#"+d+"_range_to_"+G[j]).val()};C.push(Y)}if(Q.fnSettings().oFeatures.bServerSide){var X=Q.fnSettings().fnServerData;Q.fnSettings().fnServerData=function(d,f,h){for(j=0;j<G.length;j++){var e=G[j];for(k=0;k<f.length;k++){if(f[k].name=="sSearch_"+e){f[k].value=C[j]()}}}f.push({name:"sRangeSeparator",value:I.sRangeSeparator});if(X!=null){try{X(d,f,h,Q.fnSettings())}catch(g){X(d,f,h)}}else{A.getJSON(d,f,function(i){h(i)})}}}})}})(jQuery);